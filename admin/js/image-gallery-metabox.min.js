!function(e){var t;function a(){e("#gallery-metabox-list li").each((function(t){e(this).find("input:hidden").attr("name","_igmb_image_gallery_id["+t+"]")}))}function i(){e("#gallery-metabox-list").sortable({opacity:.8,stop:function(){a()}})}e(document).on("click.igmbpAddMediaManager","#image-gallery-meta-box a.gallery-add",(function(a){a.preventDefault(),t&&t.close(),(t=wp.media.frames.media_frame=wp.media({className:"media-frame igmb-add-media-frame",frame:"select",multiple:!0,title:image_gallery_metabox.add_title,library:{type:["image","video"]},button:{text:image_gallery_metabox.add_button}})).on("select",(function(){var a=e("#gallery-metabox-list li").index(e("#gallery-metabox-list li:last")),i,m;t.state().get("selection").map((function(t,i){t=t.toJSON(),index=a+(i+1),t.mime.includes("image")?(t.sizes.thumbnail?attachmentSource=t.sizes.thumbnail.url:attachmentSource=t.url,m='<img class="image-preview" src="'+attachmentSource+'">'):(attachmentSource=t.url,m='<div class="thumbnail"><div class="centered"><img src="'+image_gallery_metabox.site_url+'/wp-includes/images/media/video.png" class="icon" alt=""></div><div class="filename"><div>'+t.filename+"</div></div></div>"),e("#gallery-metabox-list").append('<li class="attachment"><input type="hidden" name="_igmb_image_gallery_id['+index+']" value="'+t.id+'">'+m+'<a class="edit-image" href="#" title="'+image_gallery_metabox.link_edit_title+'"></a><a class="remove-image" href="#" title="'+image_gallery_metabox.link_remove_title+'"></a></li>')}))})),i(),t.open()})),e(document).on("click.igmbEditMediaManager","#image-gallery-meta-box a.edit-image",(function(a){a.preventDefault();var i=e(this);t&&t.close(),(t=wp.media.frames.media_frame=wp.media({className:"media-frame igmb-edit-media-frame",frame:"select",multiple:!1,title:image_gallery_metabox.edit_title,library:{type:["image","video"]},button:{text:image_gallery_metabox.edit_button}})).on("open",(function(){var e=t.state().get("selection");id=i.parent().find("input:hidden").val(),attachment=wp.media.attachment(id),attachment.fetch(),e.add(attachment?[attachment]:[])})),t.on("select",(function(){attachment=t.state().get("selection").first().toJSON(),attachment.sizes.thumbnail?attachmentSource=attachment.sizes.thumbnail.url:attachmentSource=attachment.url,i.parent().find("input:hidden").attr("value",attachment.id),i.parent().find("img.image-preview").attr("src",attachmentSource)})),t.open()})),e(document).on("click.igmbRemoveMedia","#image-gallery-meta-box a.remove-image",(function(t){t.preventDefault(),e(this).parents("li").animate({opacity:0},200,(function(){e(this).remove(),a()}))})),e(document).ready((function(){i()}))}(jQuery);